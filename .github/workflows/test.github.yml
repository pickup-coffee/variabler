name: 'test github'
on:
  push:
    branches: [main]
jobs:
  test-e2e:
    name: Test e2e
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install envy globally
        run: npm ci && npm link
      - name: Create a React Native app
        run: npx create-react-native-app example --yes --use-npm
        working-directory: ../
      - name: Init git repo for the React Native app
        run: |
          git config --global user.email "test@example.com"
          git config --global user.name "John Example"
          git add --all
          git commit -m "Init"
        working-directory: ../example
      - name: Init envy
        run: react-native-envy init
        working-directory: ../example
      - name: Set staging environment
        run: react-native-envy set staging
        working-directory: ../example
      - name: Check environment files exist
        run: |
          [ -e "./src/api.js" ] && echo "api.js exists" || exit 1
          [ -e "./settings.json" ] && echo "settings.json exists" || exit 1
        working-directory: ../example
      - name: Add build.gradle file
        run: react-native-envy add ./android/app/build.gradle
        working-directory: ../example
      - name: Check added file moved
        run: |
          [ -e "./android/app/build.gradle" ] && exit 1 || echo "android/app/build.gradle doesn't exist"
          [ -e "./envy/templates/build.gradle" ] && echo "templates/build.gradle exists" || exit 1
        working-directory: ../example
      - name: Add another build.gradle file
        run: react-native-envy add ./android/build.gradle --name build.main.gradle
        working-directory: ../example
      - name: Check added file moved
        run: |
          [ -e "./android/build.gradle" ] && exit 1 || echo "android/build.gradle doesn't exist"
          ls envy/templates
          [ -e "./envy/templates/build.main.gradle" ] && echo "templates/build.main.gradle exists" || exit 1
      - name: Set staging environment
        run: react-native-envy set staging
      - name: Check set files
        run: |
          [ -e "./android/build.gradle" ] && echo "android/build.gradle exists" || exit 1
          [ -e "./android/app/build.gradle" ] && echo "android/app/build.gradle exists" || exit 1
